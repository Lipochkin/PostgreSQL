# PostgreSQL
Домашка

Домашнее задание 4
Работа с базами данных, пользователями и правами

Цель:
создание новой базы данных, схемы и таблицы
создание роли для чтения данных из созданной схемы созданной базы данных
создание роли для чтения и записи из созданной схемы созданной базы данных

Описание/Пошаговая инструкция выполнения домашнего задания:

создайте новый кластер PostgresSQL 14

зайдите в созданный кластер под пользователем postgres

создайте новую базу данных testdb

зайдите в созданную базу данных под пользователем postgres

создайте новую схему testnm

создайте новую таблицу t1 с одной колонкой c1 типа integer
вставьте строку со значением c1=1

создайте новую роль readonly

дайте новой роли право на подключение к базе данных testdb

дайте новой роли право на использование схемы testnm

дайте новой роли право на select для всех таблиц схемы testnm

создайте пользователя testread с паролем test123

дайте роль readonly пользователю testread

зайдите под пользователем testread в базу данных testdb

сделайте select * from t1;

получилось? - ***нет, почитал шпаргалку, стал ходить через psql -h 127.0.0.1 -U testread -d testdb -W, не стал конфиг править***

у вас есть идеи почему? ведь права то дали? - ***нет доступа, таблица создана в схеме public а не testnm и прав на public для роли readonly не давали***

вернитесь в базу данных testdb под пользователем postgres

удалите таблицу t1

создайте ее заново но уже с явным указtанием имени схемы testnm

вставьте строку со значением c1=1

зайдите под пользователем testread в базу данных testdb

сделайте select * from testnm.t1;

получилось? есть идеи почему? - ***потому что права давали на старую табличку, на новую прав у юзера нет***

как сделать так чтобы такое больше не повторялось? - ***ALTER default privileges in SCHEMA testnm grant SELECT on TABLES to readonly; ***

сделайте select * from testnm.t1;

получилось? - *** да, таблица видна***
ура!
теперь попробуйте выполнить команду create table t2(c1 integer); insert into t2 values (2);

а как так? нам же никто прав на создание таблиц и insert в них под ролью readonly?

есть идеи как убрать эти права? если нет - смотрите шпаргалку

если вы справились сами то расскажите что сделали и почему, если смотрели шпаргалку - объясните что сделали и почему выполнив указанные в ней команды - 
***Роль public была по-умолчанию добавлена нашему юзеру, в ней CREATE разрешен, отозвал права по шпаргалке.*** 

Соответсвенно каждый пользователь может по умолчанию создавать объекты в схеме public любой базы данных, ес-но если у него есть право на подключение к этой базе данных.

теперь попробуйте выполнить команду create table t3(c1 integer); insert into t2 values (2);

расскажите что получилось и почему - ***теперь норм, прав нет - ERROR:  permission denied for schema public, т.к. на предыдущем шаге мы отозвали права для роли PUBLIC в БД TESTDB***

